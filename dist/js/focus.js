function focus(t,a){function e(t,a,e){var r=0;for(var n in t.listData)t.listData[n][a]==e&&(r+=1);return r}function r(t,a){console.log(a),t.selectAll("path.pointer").data(a).enter().append("path").attr("class","pointer").style("fill","none").style("stroke","black").style("stroke-width",.5).attr("marker-end","url(#circ)").attr("d",function(t){return t.cx>t.ox?"M"+t.sx+","+t.sy+"L"+t.ox+","+t.oy+" "+t.cx+","+t.cy:"M"+t.ox+","+t.oy+"L"+t.sx+","+t.sy+" "+t.cx+","+t.cy})}var n,i={top:50,right:30,bottom:40,left:400},o=960-i.left-i.right,s=1500-i.top-i.bottom,c=600,l=1e3,d=d3.select("#bar-chart").append("svg").attr("width",o+i.left+i.right).attr("height",s+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),u=d3.select("#pie-chart").append("svg").attr("width",l).attr("height",c).append("g").attr("transform","translate("+l/2+","+c/2+")"),p=Math.min(l,c)/2,f={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8};d3.json("../../src/fack_areas.json",function(t,r){t&&console.log(t);var i=r[a],o=[],s=0;n=i.area;for(var c in f){var l=[];l.push(f[c]),l.push(e(i,"serviceName",c)),l.push(c),o.push(l)}o=o.sort(function(t,a){return d3.descending(t[1],a[1])}),o.forEach(function(t,a){a>2&&(s+=o[a][1])}),o.splice(3,o.length-3,[9,s,"其他"]);var d=d3.layout.pie(),h=d3.svg.arc().innerRadius(p/3).outerRadius(p/4),g=d3.svg.arc().innerRadius(p/2).outerRadius(p/3),m=u.selectAll("g.arc").data(d(o.map(function(t,a,e){return t[1]}))).enter().append("g").attr({class:"arc"}),x=d3.select("#pie-chart").append("tooltip").attr("class","toolTip"),y=m.append("path").attr({fill:function(t,a){return G.colorServiceName[o[a][0]]},d:h,class:"pie-path",id:function(t,a){return o[a][2]}}).on("mousemove",function(t,a){x.style("left",d3.event.pageX+10+"px"),x.style("top",d3.event.pageY-25+"px"),x.style("display","inline-block"),x.html(o[a][2]+"<br>"+o[a][1]+"件")}).on("mouseout",function(t){x.style("display","none")});y.transition().duration(1e3).attr({d:g}),u.append("text").attr({class:"area_name",x:0,y:0,"text-anchor":"middle"}).text(n)}),d3.json("../../src/fack_items.json",function(t,a){function e(t){return t>0}function n(){return d3.svg.axis().scale(f).orient("bottom").ticks(4)}var i=[];for(var c in a)a[c].caseCount>0&&i.push(a[c]);var l=i.map(function(t){return t.item}),f=d3.scale.linear().domain(d3.extent(i,function(t){return t.caseCount})).nice().range([0,o]),h=d3.scale.ordinal().domain(l).rangeRoundBands([0,s],.1),g=d3.svg.axis().scale(f).orient("top").tickSize(0).ticks(10).tickPadding(10).tickFormat(d3.format("d")),m=d3.svg.axis().scale(h).orient("left").tickSize(0).tickPadding(10);d.append("g").attr("class","grid").attr("transform","translate(0,"+s+")").call(n().tickSize(-s,0,0).tickFormat(""));var x=d.selectAll(".bar").data(i).enter().append("g").attr("class","bar"),y=x.append("rect").attr("class","bar").attr("x",function(t){return f(Math.min(0,t.caseCount))+4}).attr("y",function(t){return h(t.item)+10}).attr("width",0).attr("height",20).attr("rx",5).attr("ry",5).attr("fill",function(t,a){return G.colorServiceItem[a]}).style("fill-opacity",.5);y.transition().delay(500).duration(function(t,a){return 60*a}).ease("linear").attr("width",function(t){return f(t.caseCount)-f(0)}).style("fill-opacity",1),i.sort(function(t,a){return d3.descending(t.caseCount,a.caseCount)}),console.log("data:"),console.log(i);var v=d3.layout.pie().sort(null),l=(d3.layout.pie().sort(null),i.map(function(t){return t.caseCount})),l=l.filter(e),k=v(l);console.log("first pie2"),console.log(v(l));var b=d3.svg.arc().innerRadius(p/3).outerRadius(p/4),A=d3.svg.arc().innerRadius(p-100).outerRadius(p-50),C=u.selectAll("g.arcs").data(k).enter().append("g").attr({class:"arcs"}),R=i.map(function(t){return t.item}),M=C.append("path").attr({fill:function(t,a){return G.colorServiceItem[a]},d:b,class:"pie-path",id:function(t,a){return R[a]+"_inner"}});M.transition().duration(1e3).attr({d:A}),k.forEach(function(t){var a=t.a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;t.cy=Math.sin(a)*(p-75),t.cx=Math.cos(a)*(p-75)});var w=[];console.log(k),u.selectAll("text").data(k).enter().append("text").attr("text-anchor","middle").attr("x",function(t,a){return t.x=Math.cos(t.a)*(p-20)}).attr("y",function(t,a){return t.y=Math.sin(t.a)*(p-20)}).text(function(t,a){return R[a]}).each(function(t,a){var e=this.getBBox();t.sx=t.x-e.width/2-2,t.ox=t.x+e.width/2+2,t.sy=t.oy=t.y+5,w.push(t),a===k.length-1&&r(u,w)}),u.append("defs").append("marker").attr("id","circ").attr("markerWidth",6).attr("markerHeight",6).attr("refX",3).attr("refY",3).append("circle").attr("cx",3).attr("cy",3).attr("r",3),h=d3.scale.ordinal().domain(i.map(function(t){return t.item})).rangeRoundBands([0,s],.1),y.data(i).transition().delay(function(t,a){return 50*a}).duration(1e3).attr("width",function(t){return f(t.caseCount)-f(0)}).attr("y",function(t,a){return h(t.item)+10}).style("fill-opacity",1),m=d3.svg.axis().scale(h).orient("left").tickSize(0).tickPadding(10),x.append("text").text(function(t){return t.caseCount+"件"}).attr("x",function(t,a){return f(t.caseCount)+10}).attr("y",function(t){return h(t.item)+23}).attr("class","bartip"),d.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(g),d.append("g").attr("class","y axis").attr("transform","translate("+f(0)+",0)").call(m)})}function resetFocus(){d3.select("#pie-chart").selectAll("*").remove(),d3.select("#bar-chart").selectAll("*").remove()}
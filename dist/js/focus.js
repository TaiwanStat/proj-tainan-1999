function focus(t,a){function e(t,a,e){var r=0;for(var n in t.listData)t.listData[n][a]===e&&(r+=1);return r}function r(){return d3.svg.axis().scale(E).orient("bottom").ticks(0)}function n(t){return t>0}function i(t,a){t.selectAll("path.pointer").data(a).enter().append("path").attr("class",function(t){var a;return a=t.value>M/40?"pointer":"foo"}).style("fill","none").style("stroke","black").style("stroke-width",.8).attr("marker-end","url(#circ)").attr("d",function(t){return t.cx>t.ox?"M"+t.sx+","+t.sy+"L"+t.ox+","+t.oy+" "+t.cx+","+t.cy:"M"+t.ox+","+t.oy+"L"+t.sx+","+t.sy+" "+t.cx+","+t.cy})}for(var o in DB.areasE)if(DB.areasE[o]===t){t=o;break}console.log("state:focus-"+t);var s,c={top:50,right:300,bottom:40,left:300},l=600,u=1e3,d=Math.min(u,l)/2,p=[],f=d3.select("#pie-chart").append("svg").attr("width",u).attr("height",l).append("g").attr("transform","translate("+u/2+","+l/2+")"),g={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及汙染":6,"民生管線":7,"動物救援":8};t="東區";var h="2016-07-01",m="2016-07-03";console.log(h+"/"+m+"/"+t);var v=G.getAreasData(h,m,[t]);console.log(v);var x=v[0];s=x.area;for(var y in g){var k=[];k.push(g[y]),k.push(e(x,"serviceName",y)),k.push(y),p.push(k)}var b=d3.layout.pie().sort(null);b=b(p.map(function(t,a,e){return t[1]})),console.log("hedree"),console.log(b);var A=d3.svg.arc().innerRadius(d/3).outerRadius(d/4),C=d3.svg.arc().innerRadius(d-115).outerRadius(d-105),B=f.selectAll("g.arc").data(b).enter().append("g").attr({class:"arc"}),D=d3.select("#pie-chart").append("tooltip").attr("class","toolTip"),R=B.append("path").attr({fill:function(t,a){return G.colorServiceName[p[a][0]]},d:A,class:"pie-path",id:function(t,a){return p[a][2]}}).on("mousemove",function(t,a){D.style("left",d3.event.pageX+10+"px"),D.style("top",d3.event.pageY-25+"px"),D.style("display","inline-block"),D.html(p[a][2]+"<br>"+p[a][1]+"件")}).on("mouseout",function(t){D.style("display","none")});R.transition().duration(1e3).attr({d:C}),console.log(h+"/"+m+"/"+t);var v=G.getItemsData(h,m,[t]);console.log(v);var M=0,w=[];for(var o in v)v[o].caseCount>0&&(w.push(v[o]),M+=v[o].caseCount);var S=950-c.left-c.right,I=46*w.length-c.top-c.bottom,z=d3.select("#bar-chart").append("svg").attr("width",S+c.left+c.right).attr("height",I+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),P=w.map(function(t){return t.item}),E=d3.scale.linear().domain(d3.extent(w,function(t){return t.caseCount})).nice().range([0,S]),F=d3.scale.ordinal().domain(P).rangeRoundBands([0,I],.1),L=d3.svg.axis().scale(E).orient("top").tickSize(0).ticks(10).tickPadding(10).tickFormat(d3.format("d")),N=d3.svg.axis().scale(F).orient("left").tickSize(0).tickPadding(10);z.append("g").attr("class","grid").attr("transform","translate(0,"+I+")").call(r().tickSize(-I,0,0).tickFormat(""));var X=z.selectAll(".bar").data(w).enter().append("g").attr("class","bar"),Y=X.append("rect").attr("class","bar").attr("x",function(t){return E(Math.min(0,t.caseCount))+4}).attr("y",function(t){return F(t.item)+10}).attr("width",0).attr("height",20).attr("rx",5).attr("ry",5).attr("fill",function(t,a){for(var e in DB.areas)if(DB.serviceItems[e]===t.item)return G.colorServiceItem[e]}).style("fill-opacity",.5);Y.transition().delay(500).duration(function(t,a){return 60*a}).ease("linear").attr("width",function(t){return E(t.caseCount)-E(0)}).style("fill-opacity",1);var b=d3.layout.pie().sort(null),P=(d3.layout.pie().sort(null),w.map(function(t){return t.caseCount})),P=P.filter(n),_=b(P),H=d3.svg.arc().innerRadius(d/3).outerRadius(d/4),T=d3.svg.arc().innerRadius(d-100).outerRadius(d-50),B=f.selectAll("g.arcs").data(_).enter().append("g").attr({class:"arcs"}),W=w.map(function(t){return t.item}),R=B.append("path").attr({fill:function(t,a){for(var e in DB.areas)if(DB.serviceItems[e]===W[a])return G.colorServiceItem[e]},d:H,class:"pie-path",id:function(t,a){return W[a]+"_inner"}});R.transition().duration(1e3).attr({d:T}),_.forEach(function(t){var a=t.a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;t.cy=Math.sin(a)*(d-75),t.cx=Math.cos(a)*(d-75)});var j=[];f.selectAll("text").data(_).enter().append("text").attr("text-anchor","middle").attr("x",function(t,a){return t.x=Math.cos(t.a)*(d-20)*1.25}).attr("y",function(t,a){return t.y=Math.sin(t.a)*(d-20)}).text(function(t,a){return t.value<M/40?"":W[a]}).each(function(t,a){var e=this.getBBox();t.sx=t.x-e.width/2-2,t.ox=t.x+e.width/2+2,t.sy=t.oy=t.y+5,j.push(t),a===_.length-1&&i(f,j)}),f.selectAll(".foo").remove(),f.append("defs").append("marker").attr("id","circ").attr("markerWidth",10).attr("markerHeight",10).attr("refX",5).attr("refY",5).append("circle").attr("cx",5).attr("cy",5).attr("r",5),w.sort(function(t,a){return d3.descending(t.caseCount,a.caseCount)}),F=d3.scale.ordinal().domain(w.map(function(t){return t.item})).rangeRoundBands([0,I],.1),Y.attr("y",function(t,a){return F(t.item)+10}).style("fill-opacity",1),Y.transition().delay(function(t,a){return 50*a}).duration(1e3).attr("width",function(t){return E(t.caseCount)-E(0)}),N=d3.svg.axis().scale(F).orient("left").tickSize(0).tickPadding(10),X.append("text").text(function(t){return t.caseCount+"件"}).attr("x",function(t,a){return E(t.caseCount)+10}).attr("y",function(t){return F(t.item)+23}).attr("class","bartip"),z.append("g").attr("class","x axis").attr("transform","translate(0,0)").call(L),z.append("g").attr("class","y axis").attr("transform","translate("+E(0)+",0)").call(N),f.append("text").attr({class:"area_name",x:0,y:0,"text-anchor":"middle"}).text(s)}function resetFocus(){d3.select("#pie-chart").selectAll("*").remove(),d3.select("#bar-chart").selectAll("*").remove()}
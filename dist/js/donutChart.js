function filterJSON(e,t,n){var a=0;for(var r in e.ListData)e.ListData[r][t]==n&&(a+=1);return a}function createDonut(e,t,n){d3.json(e,function(e,a){e&&console.log(e),console.log(a);var r=[],s=0,o=0;for(var i in service_name){var c=[];c.push(service_name[i]),c.push(filterJSON(a,"service_name",i)),c.push(i),r.push(c)}d3.select("."+n+"_name").text(t),r=r.sort(function(e,t){return d3.descending(e[1],t[1])}),console.log(r);var s=0,o=0;for(var i in r)s>2&&(o+=r[i][1]),s+=1;console.log(s);var c=[];c.push(16),c.push(o),c.push("其他"),r.splice(3,s-3,c);var l=250,u=250,d=d3.layout.pie(),p=d3.select("."+n).append("svg").attr({width:l,height:u}),v=d3.svg.arc().innerRadius(l/5).outerRadius(l/5),h=d3.svg.arc().innerRadius(l/4).outerRadius(l/3),g=d3.svg.arc().innerRadius(l/3).outerRadius(l/2.5),f=p.selectAll("g.arc").data(d(r.map(function(e,t,n){return console.log(e[1]),e[1]}))).enter().append("g").attr({class:"arc",transform:"translate("+l/2+", "+l/2+")"});console.log(r);var m=d3.scale.category20(),_=f.append("path").attr({fill:function(e,t){return console.log(m(r[t][0])),m(r[t][0])},d:v,class:function(e,t){return console.log(t),0==t?"path_special":"path"},id:function(e,t){return r[t][2]}}).on("mouseover",function(){p.append("text").attr({class:"subject_"+this.id,x:l/2,y:l/2,"text-anchor":"middle"}).text(this.id)}).on("mouseout",function(){console.log(this.id),p.selectAll(".subject_"+this.id).remove()});d3.selectAll(".path_special").attr({d:g}),_.transition().duration(1e3).attr({d:h})})}var service_name={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8};createDonut("../../src/all_item.json","安平區","column");
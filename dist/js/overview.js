!function(){function t(t,e,n,r){var s=450,i=450,o=d3.layout.pie(),c=d3.select("."+n).append("svg").attr({width:s,height:i}),l=d3.svg.arc().innerRadius(s/5).outerRadius(s/5),u=d3.svg.arc().innerRadius(s/4).outerRadius(s/3),d=d3.svg.arc().innerRadius(s/3).outerRadius(s/2.5),p=o(t.map(function(t,e,a){return t[1]})),f=c.selectAll("g.arc").data(p).enter().append("g").attr({class:"arc",transform:"translate("+s/2+", "+s/2+")"}),v=d3.select(".row").append("tooltip").attr("class","toolTip"),h=G.colorServiceName,g=f.append("path").attr({fill:function(e,a){return h[t[a][0]]},d:l,class:function(t,e){return 0==e?"path_special":"path"},id:function(e,a){return t[a][2]}}).on("mousemove",function(e,a){v.style("left",d3.event.pageX+10+"px"),v.style("top",d3.event.pageY-25+"px"),v.style("display","inline-block"),v.html(t[a][2]+"<br>"+t[a][1]+"件")}).on("mouseout",function(t){v.style("display","none")});d3.selectAll(".path_special").attr({d:d}),g.transition().duration(1e3).attr({d:u}),c.append("text").attr({id:e.eName,class:"overview_areaName",x:s/2-23,y:i-30}).text(function(t){return e.cName}).on("click",function(t){G.focusArea(this.id,r)});var m=Object.keys(a),y=t.map(function(t){return[h[t[0]],m[t[0]]]}),x=18,N=4,R=c.selectAll(".legend").data(y).enter().append("g").attr("class","legend").attr("transform",function(t,e){var a=x+N,n=a*y.length/2,r=10*x,s=e*a+4.1*n;return"translate("+r+","+s+")"});R.append("rect").attr("width",x).attr("height",x).style("fill",function(t){return t[0]}).style("stroke",h),R.append("text").attr("x",x+N).attr("y",x-N).text(function(t){return t[1]})}function e(t,e,a){var n=0;for(var r in t.listData)t.listData[r][e]==a&&(n+=1);return n}var a={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8,"其他":9};d3.json("../../src/fack_areas.json",function(n,r){n&&console.log(n),r.map(function(n,r){var s=n.area,i=[],o=0,c={cName:s,eName:DB.areasE[s]};for(var l in a){var u=[];u.push(a[l]),u.push(e(n,"serviceName",l)),u.push(l),i.push(u)}i=i.sort(function(t,e){return d3.descending(t[1],e[1])}),i.forEach(function(t,e){e>2&&(o+=i[e][1])}),i.splice(3,i.length-3,[9,o,"其他"]),t(i,c,"column",r)})})}();
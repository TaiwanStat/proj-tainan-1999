function filterJSON(t,e,a){var n=0;for(var r in t.ListData)t.ListData[r][e]==a&&(n+=1);return n}function createDonut(t,e,a){d3.json(t,function(t,n){t&&console.log(t),console.log(n);var r=[],s=0,i=0;for(var c in service_name){var u=[];u.push(service_name[c]),u.push(filterJSON(n,"service_name",c)),u.push(c),r.push(u)}d3.select("."+a+"_name").text(e),r=r.sort(function(t,e){return d3.descending(t[1],e[1])});var s=0,i=0;for(var c in r)s>2&&(i+=r[c][1]),s+=1;var u=[];u.push(16),u.push(i),u.push("其他"),r.splice(3,s-3,u);var o=250,d=250,l=d3.layout.pie(),p=d3.select("."+a).append("svg").attr({width:o,height:d}),v=d3.svg.arc().innerRadius(o/5).outerRadius(o/5),h=d3.svg.arc().innerRadius(o/4).outerRadius(o/3),f=d3.svg.arc().innerRadius(o/3).outerRadius(o/2.5),m=p.selectAll("g.arc").data(l(r.map(function(t,e,a){return t[1]}))).enter().append("g").attr({class:"arc",transform:"translate("+o/2+", "+o/2+")"}),g=d3.scale.category20(),_=m.append("path").attr({fill:function(t,e){return g(r[e][0])},d:v,class:function(t,e){return 0==e?"path_special":"path"},id:function(t,e){return r[e][2]}}).on("mouseover",function(){p.append("text").attr({class:"subject_"+this.id,x:o/2,y:o/2,"text-anchor":"middle"}).text(this.id)}).on("mouseout",function(){p.selectAll(".subject_"+this.id).remove()});d3.selectAll(".path_special").attr({d:f}),_.transition().duration(1e3).attr({d:h})})}var service_name={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8};createDonut("../../src/all_item.json","安平區","column");
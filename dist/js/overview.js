!function(){function t(t,e,a){var n=0;for(var r in t.listData)t.listData[r][e]==a&&(n+=1);return n}function e(t,e,n){var r=450,s=450,i=d3.layout.pie(),u=d3.select("."+n).append("svg").attr({width:r,height:s}),o=d3.svg.arc().innerRadius(r/5).outerRadius(r/5),l=d3.svg.arc().innerRadius(r/4).outerRadius(r/3),c=d3.svg.arc().innerRadius(r/3).outerRadius(r/2.5),d=i(t.map(function(t,e,a){return t[1]})),p=u.selectAll("g.arc").data(d).enter().append("g").attr({class:"arc",transform:"translate("+r/2+", "+r/2+")"}),f=d3.select("body").append("div").attr("class","toolTip"),v=["#E57373","#DCE775","#F06292","#BA68C8","#7986CB","#4DB6AC","#81C784","#FF8A65","#A1887F","#E0E0E0"],h=p.append("path").attr({fill:function(e,a){return v[t[a][0]]},d:o,class:function(t,e){return 0==e?"path_special":"path"},id:function(e,a){return t[a][2]}}).on("mousemove",function(e,a){f.style("left",d3.event.pageX+10+"px"),f.style("top",d3.event.pageY-25+"px"),f.style("display","inline-block"),f.html(t[a][2]+"<br>"+t[a][1]+"件")}).on("mouseout",function(t){f.style("display","none")});d3.selectAll(".path_special").attr({d:c}),h.transition().duration(1e3).attr({d:l}),u.append("text").attr({id:e.eName,x:r/2-23,y:s-30}).style("font-size","20px").text(function(t){return e.cName});var g=Object.keys(a),m=t.map(function(t){return[v[t[0]],g[t[0]]]}),y=18,x=4,A=u.selectAll(".legend").data(m).enter().append("g").attr("class","legend").attr("transform",function(t,e){var a=y+x,n=a*m.length/2,r=10*y,s=e*a+4.1*n;return"translate("+r+","+s+")"});A.append("rect").attr("width",y).attr("height",y).style("fill",function(t){return t[0]}).style("stroke",v),A.append("text").attr("x",y+x).attr("y",y-x).text(function(t){return t[1]})}var a={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8,"其他":9};d3.json("../../src/fack_areas.json",function(n,r){n&&console.log(n),r.map(function(n){var r=n.area,s=[],i=0,u=0;for(var o in a){var l=[];l.push(a[o]),l.push(t(n,"serviceName",o)),l.push(o),s.push(l)}s=s.sort(function(t,e){return d3.descending(t[1],e[1])});for(var o in s)i>2&&(u+=s[o][1]),i+=1;var l=[];l.push(9),l.push(u),l.push("其他");var c={cName:r,eName:DB.areasE[r]};s.splice(3,i-3,l),e(s,c,"column")})})}();
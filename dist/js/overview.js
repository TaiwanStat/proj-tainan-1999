!function(){function t(t,e,a,n,u){var d=d3.layout.pie();if(u<0)var p=d3.select("."+a).insert("svg",":first-child").attr({width:r,height:i});else var p=d3.select("."+a).append("svg").attr({width:r,height:i});var v=d3.svg.arc().innerRadius(r/5).outerRadius(r/5),f=d3.svg.arc().innerRadius(r/4).outerRadius(r/3),m=d3.svg.arc().innerRadius(r/3).outerRadius(r/2.5),h=d(t.map(function(t,e,a){return t[1]})),y=p.selectAll("g.arc").data(h).enter().append("g").attr({class:"arc",transform:"translate("+r/2+", "+r/2+")"}),g=d3.select(".row").append("tooltip").attr("class","toolTip"),w=G.colorServiceName,x=y.append("path").attr({fill:function(e,a){return w[t[a][0]]},d:v,class:function(t,e){return 0==e?"path_special":"path"},id:function(e,a){return t[a][2]}}).on("mousemove",function(e,a){g.style("left",d3.event.pageX+10+"px"),g.style("top",d3.event.pageY-25+"px"),g.style("display","inline-block"),g.html(t[a][2]+"<br>"+t[a][1]+"件")}).on("mouseout",function(t){g.style("display","none")});d3.selectAll(".path_special").attr({d:m}),x.transition().duration(1e3).attr({d:f}),p.append("text").attr({id:"caseCount_"+e.eName,class:"overview_caseCount",x:function(t){return n<10?r/2-5*c:n<100?r/2-9*c:n<1e3?r/2-11*c:void 0},y:i/2-10}).style("opacity",0).text(n).transition().duration(800).style({opacity:1}),p.append("text").attr("class","overview_caseCountI").attr("x",function(t){var a=parseInt($("#caseCount_"+e.eName).attr("x"));return n<10?a+7*c:n<100?a+13*c:n<1e3?a+19*c:void 0}).attr("y",$("#caseCount_"+e.eName).attr("y")-3).style("opacity",0).text("件").transition().duration(800).style({opacity:1}),p.append("text").attr({id:e.eName,class:"overview_areaName",x:r/2-35,y:i-30}).text(function(t){return e.cName+" ›"}).on("click",function(t){$(".active").removeClass("active"),$('.item[value="w"]').addClass("active"),G.focusArea(this.id,u)});var N=Object.keys(l),_=t.map(function(t){return[w[t[0]],N[t[0]]]});_.pop();var C=18,k=3,A=p.selectAll(".legend").data(_).enter().append("g").attr("class","legend").attr("transform",function(t,e){var a=C+k,n=a*_.length/2,r=o*C,i=e*a+s*n;return"translate("+r+","+i+")"});A.append("rect").attr("width",C).attr("height",C).style("fill",function(t){return t[0]}).style("stroke",w),A.append("text").attr("x",C+k).attr("y",C-k).text(function(t){return t[1]})}function e(t,e,a){var n=0;for(var r in t.listData)t.listData[r][e]==a&&(n+=1);return n}function a(){$(window).width()<=1520?(r=380,i=380,o=8.3,s=6.3,c=5):(r=450,i=450,o=10,s=7.8,c=7)}function n(){var t=G.time.curTime,e=G.time.lastWTime;$(".overview_title .date").text("． "+e.split("-")[1]+"/"+e.split("-")[2]+" ~ "+t.split("-")[1]+"/"+t.split("-")[2]+" ．")}var r,i,o,s,c,l={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8,"其他":9};n(),a(),d3.json("../../src/fack_areas.json",function(a,n){a&&console.log(a);var r=[[0,0,"違規停車"],[1,0,"路燈故障"],[2,0,"噪音舉發"],[3,0,"騎樓舉發"],[4,0,"道路維修"],[5,0,"交通運輸"],[6,0,"髒亂及污染"],[7,0,"民生管線"],[8,0,"動物救援"]];n.map(function(a,n){var i=a.area,o=[],s=0,c={cName:i,eName:DB.areasE[i]};for(var u in l){var d=[];d.push(l[u]),d.push(e(a,"serviceName",u)),d.push(u),o.push(d)}for(var p=0;p<9;p++)r[p][1]+=o[p][1];o=o.sort(function(t,e){return d3.descending(t[1],e[1])}),o.forEach(function(t,e){e>2&&(s+=o[e][1])}),o.splice(3,o.length-3,[9,s,"其他"]),t(o,c,"column",a.caseCount,n)}),r=r.sort(function(t,e){return d3.descending(t[1],e[1])});var i=0,o=0;r.forEach(function(t,e){e>2&&(i+=r[e][1]),o+=r[e][1]}),r.splice(3,r.length-3,[9,i,"其他"]);var s={cName:"台南市",eName:"All"};t(r,s,"column",o,-1)}),$(".ui.dropdown.overview_selectArea").dropdown({onChange:function(t,e,a){$("html, body").animate({scrollTop:$("#"+t).offset().top-400},"easeInBack",function(){window.location.hash=t})}})}();
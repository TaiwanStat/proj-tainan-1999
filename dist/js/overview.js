function filtJSON(t,e,a){var n=0;for(var r in t.listData)t.listData[r][e]==a&&(n+=1);return n}function createDonut(t,e,a){var n=450,r=450,s=d3.layout.pie(),i=d3.select("."+a).append("svg").attr({width:n,height:r}),u=d3.svg.arc().innerRadius(n/5).outerRadius(n/5),c=d3.svg.arc().innerRadius(n/4).outerRadius(n/3),o=d3.svg.arc().innerRadius(n/3).outerRadius(n/2.5),l=s(t.map(function(t,e,a){return t[1]})),d=i.selectAll("g.arc").data(l).enter().append("g").attr({class:"arc",transform:"translate("+n/2+", "+n/2+")"}),p=d3.select("body").append("div").attr("class","toolTip"),f=["#E57373","#DCE775","#F06292","#BA68C8","#7986CB","#4DB6AC","#81C784","#FF8A65","#A1887F","#E0E0E0"],v=d.append("path").attr({fill:function(e,a){return f[t[a][0]]},d:u,class:function(t,e){return 0==e?"path_special":"path"},id:function(e,a){return t[a][2]}}).on("mousemove",function(e,a){p.style("left",d3.event.pageX+10+"px"),p.style("top",d3.event.pageY-25+"px"),p.style("display","inline-block"),p.html(t[a][2]+"<br>"+t[a][1]+"件")}).on("mouseout",function(t){p.style("display","none")});d3.selectAll(".path_special").attr({d:o}),v.transition().duration(1e3).attr({d:c}),i.append("text").attr({id:e.eName,x:n/2-23,y:r-30}).style("font-size","20px").text(function(t){return e.cName});var m=Object.keys(service_name),h=t.map(function(t){return[f[t[0]],m[t[0]]]}),g=18,y=4,x=i.selectAll(".legend").data(h).enter().append("g").attr("class","legend").attr("transform",function(t,e){var a=g+y,n=a*h.length/2,r=10*g,s=e*a+4.1*n;return"translate("+r+","+s+")"});x.append("rect").attr("width",g).attr("height",g).style("fill",function(t){return t[0]}).style("stroke",f),x.append("text").attr("x",g+y).attr("y",g-y).text(function(t){return t[1]})}var service_name={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及污染":6,"民生管線":7,"動物救援":8,"其他":9},array=[],count=0,sum=0;d3.json("../../src/fack_areas.json",function(t,e){t&&console.log(t),e.map(function(t){var e=t.area,a=[],n=0,r=0;for(var s in service_name){var i=[];i.push(service_name[s]),i.push(filtJSON(t,"serviceName",s)),i.push(s),a.push(i)}a=a.sort(function(t,e){return d3.descending(t[1],e[1])});for(var s in a)n>2&&(r+=a[s][1]),n+=1;var i=[];i.push(9),i.push(r),i.push("其他");var u={cName:e,eName:DB.areasE[e]};a.splice(3,n-3,i),createDonut(a,u,"column")})});
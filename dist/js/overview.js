!function(){function t(){var t=G.getAreasData(d,p,DB.areas);console.log(11),error&&console.log(error);var n=[[0,0,"違規停車"],[1,0,"路燈故障"],[2,0,"噪音舉發"],[3,0,"騎樓舉發"],[4,0,"道路維修"],[5,0,"交通運輸"],[6,0,"髒亂及污染"],[7,0,"民生管線"],[8,0,"動物救援"],[9,0,"其他"]];t.areasArray.map(function(t,r){var i=t.area,o=[],s=0,c={cName:i,eName:DB.areasE[i]};for(var l in u){var d=[];d.push(u[l]),d.push(a(t,"serviceName",l)),d.push(l),o.push(d)}for(var p=0;p<10;p++)n[p][1]+=o[p][1];o=o.sort(function(t,e){return d3.descending(t[1],e[1])}),o.forEach(function(t,e){e>2&&(s+=o[e][1])}),o.splice(3,o.length-3,[9,s,"其他"]),e(o,c,"column",t.caseCount,r)}),n=n.sort(function(t,e){return d3.descending(t[1],e[1])});var r=0,i=0;n.forEach(function(t,e){e>2&&(r+=n[e][1]),i+=n[e][1]}),n.splice(3,n.length-3,[9,r,"其他"]);var o={cName:"台南市",eName:"Focus"};e(n,o,"column",i,-1)}function e(t,e,a,n,r){var d=d3.layout.pie();if(r<0)var p=d3.select("."+a).insert("svg",":first-child").attr({width:i,height:o});else var p=d3.select("."+a).append("svg").attr({width:i,height:o});var v=d3.svg.arc().innerRadius(i/5).outerRadius(i/5),f=d3.svg.arc().innerRadius(i/4).outerRadius(i/3),m=d3.svg.arc().innerRadius(i/3).outerRadius(i/2.5),h=d(t.map(function(t,e,a){return t[1]})),y=p.selectAll("g.arc").data(h).enter().append("g").attr({class:"arc",transform:"translate("+i/2+", "+i/2+")"}),g=d3.select(".row").append("tooltip").attr("class","toolTip"),w=G.colorServiceName,x=y.append("path").attr({fill:function(e,a){return w[t[a][0]]},d:v,class:function(t,e){return 0===e?"path_special":"path"},id:function(e,a){return t[a][2]}}).on("mousemove",function(e,a){var r=(parseFloat(t[a][1])/n*100).toFixed(1);g.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-25+"px").style("display","inline-block").html(t[a][2]+"<br>"+r+"％")}).on("mouseout",function(t){g.style("display","none")});d3.selectAll(".path_special").attr({d:m}),x.transition().duration(1e3).attr({d:f}),p.append("text").attr({id:"caseCount_"+e.eName,class:"overview_caseCount",x:function(t){return n<10?i/2-5*l:n<100?i/2-9*l:n<1e3?i/2-11*l:void 0},y:o/2-10}).style("opacity",0).text(n).transition().duration(800).style({opacity:1}),p.append("text").attr("class","overview_caseCountI").attr("x",function(t){var a=parseInt($("#caseCount_"+e.eName).attr("x"));return n<10?a+7*l:n<100?a+13*l:n<1e3?a+19*l:void 0}).attr("y",$("#caseCount_"+e.eName).attr("y")-3).style("opacity",0).text("件").transition().duration(800).style({opacity:1}),p.append("text").attr({id:e.eName,class:"overview_areaName",x:i/2-35,y:o-30}).text(function(t){return e.cName+" ›"}).on("click",function(t){$(".active").removeClass("active"),$('.item[value="w"]').addClass("active"),G.focusArea(this.id,r)});var N=Object.keys(u),C=t.map(function(t){return[w[t[0]],N[t[0]]]});C.pop();var _=18,A=3,D=p.selectAll(".legend").data(C).enter().append("g").attr("class","legend").attr("transform",function(t,e){var a=_+A,n=a*C.length/2,r=s*_,i=e*a+c*n;return"translate("+r+","+i+")"});D.append("rect").attr("width",_).attr("height",_).style("fill",function(t){return t[0]}).style("stroke",w),D.append("text").attr("x",_+A).attr("y",_-A).text(function(t){return t[1]})}function a(t,e,a){var n=0;for(var r in t.listData)t.listData[r][e]===a&&(n+=t.listData[r].caseCount);return n}function n(){$(window).width()<=1520?(i=380,o=380,s=8.3,c=6.3,l=5):(i=450,o=450,s=10,c=7.8,l=7)}function r(){var t=G.time.curTime,e=G.time.lastWTime;$(".overview_title .date").text("． "+e.split("-")[1]+"/"+e.split("-")[2]+" ~ "+t.split("-")[1]+"/"+t.split("-")[2]+" ．")}var i,o,s,c,l,u={"違規停車":0,"路燈故障":1,"噪音舉發":2,"騎樓舉發":3,"道路維修":4,"交通運輸":5,"髒亂及汙染":6,"民生管線":7,"動物救援":8,"其他":9};r(),n();var d=G.time.lastWTime,p=G.time.curTime;window.overview=t,$(".ui.dropdown.overview_selectArea").dropdown({onChange:function(t,e,a){$("html, body").animate({scrollTop:$("#"+t).offset().top-400},"easeInBack",function(){window.location.hash=t})}})}();
!function(){function t(t){var e=t.map(function(t){return t.item});console.log(e);for(var r in e);var o=n(t);console.log(123),console.log(o.children);var i,l=[],a=0;for(var r in o.children)o.children[r].value>=a&&(a=o.children[r].value,i=o.children[r].item),l.push(o.children[r].value);d3.select("#description").text(i),console.log(l);var s=d3.quantile(l,.1);console.log(s),bubble_data=c.nodes(o).filter(function(t){return t.parent});var u=d.selectAll("circle").data(bubble_data).enter().append("circle").attr({cx:function(t){return t.x},cy:function(t){return 0},r:function(t){return t.r},fill:function(t,e){return t.item_color},id:function(t,e){return"id"+t.item},opacity:0}).on("mouseover",function(){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),d3.select("#description").text(d3.select(this).attr("id").slice(2)),p.transition().duration(100).style({opacity:.9}),p.html(d3.select(this).attr("id").slice(2)+"<br>").style({left:d3.event.pageX+20+"px",top:d3.event.pageY+20+"px"})}).on("mouseout",function(){p.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})});u.transition().duration(1e3).attr({opacity:1,cy:function(t){return t.y}});d.selectAll("#item_text").data(bubble_data).enter().append("text").attr({x:function(t){return t.x},y:function(t){return 0},id:"item_text",color:"#eee"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>s&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).transition().duration(1e3).attr({y:function(t){return t.y}})}function e(t){var e,r=n(t),o=[],i=0;for(var l in r.children)r.children[l].value>=i&&(i=r.children[l].value,e=r.children[l].item),o.push(r.children[l].value);d3.select("#description").text(e);var a=d3.quantile(o,.1);bubble_data2=c.nodes(r).filter(function(t){return t.parent});var s=d.selectAll("circle").data(bubble_data2);s.transition().duration(1e3).attr({cx:function(t){return t.x},cy:function(t){return t.y},r:function(t){return t.r}}),d.selectAll("#item_text").remove();var u=d.selectAll("#item_text").data(bubble_data2).enter().append("text").attr({id:"item_text"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>a&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).attr({opacity:0});u.transition().duration(1e3).attr({x:function(t){return t.x},y:function(t){return t.y},opacity:1})}function n(t){var e=[];return t.forEach(function(t,n){var r=t.caseCount,o=i[n];e.push({value:r,item_color:o,item:t.item})}),{children:e}}function r(){var t;d3.select("#play_icon").on("click",function(){t=setInterval(function(){if(v(s._d)!=v(u._d)){var n=moment.duration({days:1});console.log(s),s=s.add(n),console.log(v(s._d)),d3.select("#show_date").text(v(s._d)),f++,d3.select(".d3-slider-handle").style({left:function(){return f/m*100+"%"}}),d3.json("../../src/faked2.json",function(t,n){t&&console.log(t),e(n)}),v(s._d)===v(u._d)&&clearInterval(t)}else clearIntnterval(t)},2e3)}),d3.select("#pause_icon").on("click",function(){clearInterval(t)}),d3.select("#stop_icon").on("click",function(){f=0,d3.select("#show_date").text(v(u._d)),d3.select(".d3-slider-handle").style({left:"0%"}),d3.json("../../src/faked.json",function(t,n){t&&console.log(t),e(n)}),clearInterval(t)}),d3.select("#show_date").text()}var o=800,i=(d3.format(",d"),["#E57373","#D4E157","#CDDC39","#AB47BC","#8E24AA","#BA68C8","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E","#B2DFDB","#4DB6AC","#009688","#00796B","#004D40","#A5D6A7","#81C784","#66BB6A","#66BB6A","#43A047","#388E3C","#2E7D32","#FFCCBC","#FF8A65","#FF5722","#E64A19","#BF360C","#8D6E63","#6D4C41"]),l=600,a=6;d3.json("../../src/faked.json",function(e,n){e&&console.log(e),console.log(n),t(n)});var c=d3.layout.pack().sort(null).size([o,l]).padding(a),d=d3.select("#bubble_chart").append("svg").attr({width:o,height:l,class:"bubble_chart"});r();var s=moment("2016-11-09"),u=new moment,f=0,m=parseInt((u._d-s._d)/864e5),v=d3.time.format("%Y-%m-%d");d3.select("#scroll_bar").call(d3.slider().min(0).max(m).step(1).on("slide",function(t,n){f=n;var r=moment.duration({days:n});s=moment("2016-11-09").add(r),d3.select("#show_date").text(v(s._d)),d3.json("../../src/faked2.json",function(t,n){t&&console.log(t),e(n)})}));var p=d3.select("body").append("div").attr("class","tooltip").style("opacity",0)}();
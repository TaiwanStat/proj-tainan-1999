!function(){function t(t){var e={};for(var n in DB.serviceItems)e[DB.serviceItems[n]]="";console.log(e),console.log(t);for(var n in t){var i={};for(var o in DB.areas)i[DB.areas[o]]=0;for(var o in t[n].listData)i[t[n].listData[o].area]++;console.log(i),district_sorted=Object.keys(i).sort(function(t,e){return i[e]-i[t]}),e[t[n].item]=district_sorted[0]+i[district_sorted[0]]+"件<br>"+district_sorted[1]+i[district_sorted[1]]+"件<br>"+district_sorted[2]+i[district_sorted[2]]+"件<br>"}console.log(e);var a=r(t);console.log(123),console.log(a.children);var c,u=[],f=0;for(var n in a.children)a.children[n].value>=f&&(f=a.children[n].value,c=a.children[n].item),u.push(a.children[n].value);d3.select("#description").text(c),console.log(u);var v=d3.quantile(u,.1);console.log(v),bubble_data=l.nodes(a).filter(function(t){return t.parent});var m=d.selectAll("circle").data(bubble_data).enter().append("circle").attr({cx:function(t){return t.x},cy:function(t){return 0},r:function(t){return t.r},fill:function(t,e){return t.item_color},id:function(t,e){return"id"+t.item},opacity:0}).on("mouseover",function(){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),d3.select("#description").text(d3.select(this).attr("id").slice(2)),s.transition().duration(100).style({opacity:.9}),s.html(d3.select(this).attr("id").slice(2)+":<br>"+e[d3.select(this).attr("id").slice(2)]).style({left:d3.event.pageX+"px",top:d3.event.pageY+"px"})}).on("mouseout",function(){s.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})});m.transition().duration(1e3).attr({opacity:1,cy:function(t){return t.y}});d.selectAll("#item_text").data(bubble_data).enter().append("text").attr({x:function(t){return t.x},y:function(t){return 0},id:"item_text",color:"#eee"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>v&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).transition().duration(1e3).attr({y:function(t){return t.y}})}function e(t){var e={};for(var n in DB.serviceItems)e[DB.serviceItems[n]]="";console.log(e),console.log(t);for(var n in t){var i={};for(var o in DB.areas)i[DB.areas[o]]=0;for(var o in t[n].listData)i[t[n].listData[o].area]++;console.log(i),district_sorted=Object.keys(i).sort(function(t,e){return i[e]-i[t]}),e[t[n].item]=district_sorted[0]+i[district_sorted[0]]+"件<br>"+district_sorted[1]+i[district_sorted[1]]+"件<br>"+district_sorted[2]+i[district_sorted[2]]+"件<br>"}var a,c=r(t),u=[],f=0;for(var n in c.children)c.children[n].value>=f&&(f=c.children[n].value,a=c.children[n].item),u.push(c.children[n].value);d3.select("#description").text(a);var v=d3.quantile(u,.1);bubble_data2=l.nodes(c).filter(function(t){return t.parent});var m=d.selectAll("circle").data(bubble_data2).on("mouseover",function(){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),d3.select("#description").text(d3.select(this).attr("id").slice(2)),s.transition().duration(100).style({opacity:.9}),s.html(d3.select(this).attr("id").slice(2)+":<br>"+e[d3.select(this).attr("id").slice(2)]).style({left:d3.event.pageX+"px",top:d3.event.pageY+"px"})}).on("mouseout",function(){s.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})});m.transition().duration(1e3).attr({cx:function(t){return t.x},cy:function(t){return t.y},r:function(t){return t.r}}),d.selectAll("#item_text").remove();var _=d.selectAll("#item_text").data(bubble_data2).enter().append("text").attr({id:"item_text"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>v&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).attr({opacity:0});_.transition().duration(1e3).attr({x:function(t){return t.x},y:function(t){return t.y},opacity:1})}function r(t){var e=[];return t.forEach(function(t,r){var n=t.caseCount,i=o[r];e.push({value:n,item_color:i,item:t.item})}),{children:e}}function n(){var t;d3.select("#play_icon").on("click",function(){t=setInterval(function(){if(_(u._d)!=_(f._d)){var r=moment.duration({days:1});console.log(u),u=u.add(r),console.log(_(u._d)),d3.select("#show_date").text(_(u._d)),v++,d3.select(".d3-slider-handle").style({left:function(){return v/m*100+"%"}}),d3.json("../../src/faked2.json",function(t,r){t&&console.log(t),e(r)}),_(u._d)===_(f._d)&&clearInterval(t)}else clearIntnterval(t)},2e3)}),d3.select("#pause_icon").on("click",function(){clearInterval(t)}),d3.select("#stop_icon").on("click",function(){v=0,d3.select("#show_date").text(_(f._d)),d3.select(".d3-slider-handle").style({left:"0%"}),d3.json("../../src/faked.json",function(t,r){t&&console.log(t),e(r)}),clearInterval(t)}),d3.select("#show_date").text()}var i=800,o=(d3.format(",d"),["#E57373","#D4E157","#CDDC39","#AB47BC","#8E24AA","#BA68C8","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E","#B2DFDB","#4DB6AC","#009688","#00796B","#004D40","#A5D6A7","#81C784","#66BB6A","#66BB6A","#43A047","#388E3C","#2E7D32","#FFCCBC","#FF8A65","#FF5722","#E64A19","#BF360C","#8D6E63","#6D4C41"]),s=d3.select("#bubbule_tooltip").append("div").attr("class","bubble_tooltip").attr("opacity",1),a=600,c=6;d3.json("../../src/faked.json",function(e,r){e&&console.log(e),t(r)});var l=d3.layout.pack().sort(null).size([i,a]).padding(c),d=d3.select("#bubble_chart").append("svg").attr({width:i,height:a,id:"bubble_chart"});n();var u=moment("2016-11-09"),f=new moment,v=0,m=parseInt((f._d-u._d)/864e5),_=d3.time.format("%Y-%m-%d");d3.select("#scroll_bar").call(d3.slider().min(0).max(m).step(1).on("slide",function(t,r){v=r;var n=moment.duration({days:v});u=moment("2016-11-09").add(n),d3.selectAll("#show_date").text(_(u._d)),d3.json("../../src/faked2.json",function(t,r){t&&console.log(t),e(r)})}))}();
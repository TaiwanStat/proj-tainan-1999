!function(){function t(t){y.css({"background-image":"-webkit-linear-gradient(left ,#222 0%,#222 "+t+"%,#eee "+t+"%, #eee 100%)"})}function e(t){y.css({"background-image":"-webkit-linear-gradient(left ,#222 0%,#222 "+t+"%,#eee "+t+"%, #eee 100%)"});var e=moment.duration({days:b/100*t});v=moment("2016-11-09").add(e),d3.selectAll("#show_date").text(h(v._d)),m!=h(v._d)&&(d3.json("../../src/faked2.json",function(t,e){t&&console.log(t),n(e)}),m=h(v._d))}function r(t){var e={};for(var r in DB.serviceItems)e[DB.serviceItems[r]]="";for(var r in t){var n={};for(var o in DB.areas)n[DB.areas[o]]=0;for(var o in t[r].listData)n[t[r].listData[o].area]++;district_sorted=Object.keys(n).sort(function(t,e){return n[e]-n[t]}),e[t[r].item]=district_sorted[0]+n[district_sorted[0]]+"件<br>"+district_sorted[1]+n[district_sorted[1]]+"件<br>"+district_sorted[2]+n[district_sorted[2]]+"件<br>"}var a=i(t);console.log(123),console.log(a.children);var c,d=[],l=0;for(var r in a.children)a.children[r].value>=l&&(l=a.children[r].value,c=a.children[r].item),d.push(a.children[r].value);d3.select("#description").text(c),console.log(d);var v=d3.quantile(d,.1);console.log(v),bubble_data=u.nodes(a).filter(function(t){return t.parent});var m=f.selectAll("circle").data(bubble_data).enter().append("circle").attr({cx:function(t){return t.x},cy:function(t){return 0},r:function(t){return t.r},fill:function(t,e){return t.item_color},id:function(t,e){return"id"+t.item},opacity:0}).on("mouseover",function(){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),d3.select("#description").text(d3.select(this).attr("id").slice(2)),s.transition().duration(100).style({opacity:.9}),s.html(d3.select(this).attr("id").slice(2)+":<br>"+e[d3.select(this).attr("id").slice(2)]).style({left:d3.event.pageX+"px",top:d3.event.pageY+"px"})}).on("mouseout",function(){s.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})});m.transition().duration(1e3).attr({opacity:1,cy:function(t){return t.y}});f.selectAll("#item_text").data(bubble_data).enter().append("text").attr({x:function(t){return t.x},y:function(t){return 0},id:"item_text",color:"#eee"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>v&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).transition().duration(1e3).attr({y:function(t){return t.y}})}function n(t){var e={};for(var r in DB.serviceItems)e[DB.serviceItems[r]]="";for(var r in t){var n={};for(var o in DB.areas)n[DB.areas[o]]=0;for(var o in t[r].listData)n[t[r].listData[o].area]++;district_sorted=Object.keys(n).sort(function(t,e){return n[e]-n[t]}),e[t[r].item]=district_sorted[0]+n[district_sorted[0]]+"件<br>"+district_sorted[1]+n[district_sorted[1]]+"件<br>"+district_sorted[2]+n[district_sorted[2]]+"件<br>"}var a,c=i(t),d=[],l=0;for(var r in c.children)c.children[r].value>=l&&(l=c.children[r].value,a=c.children[r].item),d.push(c.children[r].value);d3.select("#description").text(a);var v=d3.quantile(d,.1);bubble_data2=u.nodes(c).filter(function(t){return t.parent});var m=f.selectAll("circle").data(bubble_data2).on("mouseover",function(){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),d3.select("#description").text(d3.select(this).attr("id").slice(2)),s.transition().duration(100).style({opacity:.9}),s.html(d3.select(this).attr("id").slice(2)+":<br>"+e[d3.select(this).attr("id").slice(2)]).style({left:d3.event.pageX+"px",top:d3.event.pageY+"px"})}).on("mouseout",function(){s.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})});m.transition().duration(1e3).attr({cx:function(t){return t.x},cy:function(t){return t.y},r:function(t){return t.r}}),f.selectAll("#item_text").remove();var p=f.selectAll("#item_text").data(bubble_data2).enter().append("text").attr({id:"item_text"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>v&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).attr({opacity:0});p.transition().duration(1e3).attr({x:function(t){return t.x},y:function(t){return t.y},opacity:1})}function i(t){var e=[];return t.forEach(function(t,r){var n=t.caseCount,i=c[r];e.push({value:n,item_color:i,item:t.item})}),{children:e}}function o(){var t;d3.select("#play_icon").on("click",function(){0==g&&(g=!0,t=setInterval(function(){if(h(v._d)!=h(p._d)&&_<100){var r=moment.duration({days:1});v=v.add(r),d3.select("#show_date").text(h(v._d)),console.log(_),_=parseInt(_)+100/b,console.log(_),e(parseInt(_)),x=document.getElementById("slider_input"),x.value=parseInt(_),(h(v._d)===h(p._d)||_>=100)&&clearInterval(t)}else clearIntnterval(t)},2e3))}),d3.select("#pause_icon").on("click",function(){g=!1,clearInterval(t)}),d3.select("#stop_icon").on("click",function(){g=!1,d3.select("#show_date").text(h(v._d)),_=0,console.log(_),e(_),x=document.getElementById("slider_input"),x.value=parseInt(_),clearInterval(t)}),d3.select("#show_date").text()}var a=800,c=(d3.format(",d"),["#E57373","#D4E157","#CDDC39","#AB47BC","#8E24AA","#BA68C8","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E","#B2DFDB","#4DB6AC","#009688","#00796B","#004D40","#A5D6A7","#81C784","#66BB6A","#66BB6A","#43A047","#388E3C","#2E7D32","#FFCCBC","#FF8A65","#FF5722","#E64A19","#BF360C","#8D6E63","#6D4C41"]),s=d3.select("#bubbule_tooltip").append("div").attr("class","bubble_tooltip").attr("opacity",1),d=600,l=6;d3.json("../../src/faked.json",function(t,e){t&&console.log(t),r(e)});var u=d3.layout.pack().sort(null).size([a,d]).padding(l),f=d3.select("#bubble_chart").append("svg").attr({width:a,height:d,id:"bubble_chart"});o();var v=moment("2016-11-09"),m="2016-11-09",p=new moment,_=0,b=parseInt((p._d-v._d)/864e5),h=d3.time.format("%Y-%m-%d"),y=$("input");y.on("mouseenter",function(){console.log(_),y.on("click",function(){_=y.val(),e(_)}),y.on("mousemove",function(){_=y.val(),t(_)})});var g=!1}();
!function(){function t(t){y.css({"background-image":"-webkit-linear-gradient(left ,#222 0%,#222 "+t+"%,#d3d3d5 "+t+"%, #d3d3d5 100%)"})}function e(t){y.css({"background-image":"-webkit-linear-gradient(left ,#222 0%,#222 "+t+"%,#d3d3d5 "+t+"%, #d3d3d5 100%)"});var e=moment.duration({days:b/100*t});f=moment("2016-11-09").add(e),p!=_(f._d)&&(d3.json("../../src/faked2.json",function(t,e){t&&console.log(t),n(e,"c")}),p=_(f._d))}function n(t,e){e=e||"c";var n={},o=r(t),c=[],s=0;for(var f in DB.serviceItems)n[DB.serviceItems[f]]="";for(var f in t){var p={};for(var m in DB.areas)p[DB.areas[m]]=0;for(var m in t[f].listData)p[t[f].listData[m].area]++;district_sorted=Object.keys(p).sort(function(t,e){return p[e]-p[t]}),n[t[f].item]=district_sorted[0]+p[district_sorted[0]]+"件<br>"+district_sorted[1]+p[district_sorted[1]]+"件<br>"+district_sorted[2]+p[district_sorted[2]]+"件<br>"}for(var f in o.children)o.children[f].value>=s&&(s=o.children[f].value),c.push(o.children[f].value);var v=d3.quantile(c,.1);if(bubble_data=d.nodes(o).filter(function(t){return t.parent}),"s"===e)var b=u.selectAll("circle").data(bubble_data).enter().append("circle").attr({cx:function(t){return t.x},cy:function(t){return 0},r:function(t){return t.r},fill:function(t,e){return t.item_color},id:function(t,e){return"id"+t.item},opacity:0});else var b=u.selectAll("circle").data(bubble_data);b.on("mouseover",function(t){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),l.transition().duration(100).style({opacity:.9}),l.html('<span class = "bubble_tooltipName">'+d3.select(this).attr("id").slice(2)+"( "+t.value+"件 )</span><br>"+n[d3.select(this).attr("id").slice(2)]).style({left:d3.event.pageX+"px",top:d3.event.pageY+"px"})}).on("mouseout",function(){l.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})}),"s"===e?b.transition().duration(1e3).attr({opacity:1,cy:function(t){return t.y}}):b.transition().duration(1e3).attr({cx:function(t){return t.x},cy:function(t){return t.y},r:function(t){return t.r}}),i();u.selectAll("#item_text").data(bubble_data).enter().append("text").attr({x:function(t){return t.x-5},y:function(t){return t.y-5},id:"item_text"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>v&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).transition().duration(1e3).attr({x:function(t){return t.x},y:function(t){return t.y},opacity:1});a(t)}function r(t){var e=[];return t.forEach(function(t,n){var r=t.caseCount,a=G.colorServiceItem[n];e.push({value:r,item_color:a,item:t.item})}),{children:e}}function a(t){var e=t.sort(function(t,e){return t.caseCount<e.caseCount?1:t.caseCount>e.caseCount?-1:0});$(".descriptionTime").text(_(f._d));for(var n=0;n<3;n++)$(".descriptionItem>#item"+n).text(n+1+". "+e[n].item+": "+e[n].caseCount+"件")}function i(){u.selectAll("#item_text").remove()}var o=800,c=600,s=7,l=(d3.format(",d"),d3.select("#bubbule_tooltip").append("div").attr("class","bubble_tooltip").attr("opacity",1));d3.json("../../src/faked.json",function(t,e){t&&console.log(t),n(e,"s")});var d=d3.layout.pack().sort(null).size([o,c]).padding(s),u=d3.select("#bubble_chart").append("svg").attr({width:o,height:c,id:"bubble_chart"}),f=moment("2016-11-09"),p="2016-11-09",m=new moment,v=0,b=parseInt((m._d-f._d)/864e5),_=d3.time.format("%Y-%m-%d"),y=$("input");y.on("mouseenter",function(){console.log(v),y.on("click",function(){v=y.val(),e(v)}),y.on("mousemove",function(){v=y.val(),t(v)})});var h,g="pause";d3.select("#play_icon").on("click",function(){"pause"===g?(g="play",$("#play_icon").removeClass("fa-play").addClass("fa-pause"),$("html, body").animate({scrollTop:$("#scroll_container").offset().top-5},"easeInBack"),h=setInterval(function(){if(_(f._d)!=_(m._d)&&v<100){var t=moment.duration({days:1});f=f.add(t),console.log(v),v=parseInt(v)+100/b,console.log(v),e(parseInt(v)),x=document.getElementById("slider_input"),x.value=parseInt(v),(_(f._d)===_(m._d)||v>=100)&&clearInterval(h)}else console.log(h),clearIntnterval(h)},2e3)):"play"===g?(g="pause",clearInterval(h),$("#play_icon").removeClass("fa-pause").addClass("fa-play")):alert("這真的出錯了！！")}),d3.select("#stop_icon").on("click",function(){v=0,e(v),x=document.getElementById("slider_input"),x.value=parseInt(v),clearInterval(h),g="pause",$("#play_icon").removeClass("fa-pause").addClass("fa-play")})}();
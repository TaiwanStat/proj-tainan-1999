function draw(t){var e=t.map(function(t){return t.item});console.log(e);for(var n in e);var a=data_filter(t);console.log(123),console.log(a.children);var o,r=[],d=0;for(var n in a.children)a.children[n].value>=d&&(d=a.children[n].value,o=a.children[n].item),r.push(a.children[n].value);d3.select("#description").text(o),console.log(r);var l=d3.quantile(r,.1);console.log(l),bubble_data=bubble.nodes(a).filter(function(t){return t.parent});var i=svg.selectAll("circle").data(bubble_data).enter().append("circle").attr({cx:function(t){return t.x},cy:function(t){return 0},r:function(t){return t.r},fill:function(t,e){return t.item_color},id:function(t,e){return"id"+t.item},opacity:0}).on("mouseover",function(){d3.select(this).attr({stroke:"rgba(0, 0, 0, 0.2)","stroke-width":3}),d3.select("#description").text(d3.select(this).attr("id").slice(2)),tooltip_div.transition().duration(100).style({opacity:.9}),tooltip_div.html(d3.select(this).attr("id").slice(2)+"<br>").style({left:d3.event.pageX+20+"px",top:d3.event.pageY+20+"px"})}).on("mouseout",function(){tooltip_div.transition().duration(100).style({opacity:0}),d3.select(this).attr({"stroke-width":1})});i.transition().duration(1e3).attr({opacity:1,cy:function(t){return t.y}});svg.selectAll("#item_text").data(bubble_data).enter().append("text").attr({x:function(t){return t.x},y:function(t){return 0},id:"item_text",color:"#eee"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>l&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).transition().duration(1e3).attr({y:function(t){return t.y}})}function change(t){var e,n=data_filter(t),a=[],o=0;for(var r in n.children)n.children[r].value>=o&&(o=n.children[r].value,e=n.children[r].item),a.push(n.children[r].value);d3.select("#description").text(e);var d=d3.quantile(a,.1);bubble_data2=bubble.nodes(n).filter(function(t){return t.parent});var l=svg.selectAll("circle").data(bubble_data2);l.transition().duration(1e3).attr({cx:function(t){return t.x},cy:function(t){return t.y},r:function(t){return t.r}}),svg.selectAll("#item_text").remove();var i=svg.selectAll("#item_text").data(bubble_data2).enter().append("text").attr({id:"item_text"}).style({"text-anchor":"middle"}).text(function(t){if(t.value>d&&d3.select("#id"+t.item).attr("r")/t.item.length>=7)return t.item}).attr({opacity:0});i.transition().duration(1e3).attr({x:function(t){return t.x},y:function(t){return t.y},opacity:1})}function data_filter(t){var e=[];return t.forEach(function(t,n){var a=t.caseCount,o=color[n];e.push({value:a,item_color:o,item:t.item})}),{children:e}}function option(){var t;d3.select("#play_icon").on("click",function(){t=setInterval(function(){if(dateGOGO(select_date._d)!=dateGOGO(now_date._d)){var e=moment.duration({days:1});console.log(select_date),select_date=select_date.add(e),console.log(dateGOGO(select_date._d)),d3.select("#show_date").text(dateGOGO(select_date._d)),now_bar_value++,d3.select(".d3-slider-handle").style({left:function(){return now_bar_value/duration_day*100+"%"}}),d3.json("../../src/faked2.json",function(t,e){t&&console.log(t),change(e)}),dateGOGO(select_date._d)===dateGOGO(now_date._d)&&clearInterval(t)}else clearIntnterval(t)},2e3)}),d3.select("#pause_icon").on("click",function(){clearInterval(t)}),d3.select("#stop_icon").on("click",function(){now_bar_value=0,d3.select("#show_date").text(dateGOGO(now_date._d)),d3.select(".d3-slider-handle").style({left:"0%"}),d3.json("../../src/faked.json",function(t,e){t&&console.log(t),change(e)}),clearInterval(t)}),d3.select("#show_date").text()}var width=800,format=d3.format(",d"),color=["#E57373","#D4E157","#CDDC39","#AB47BC","#8E24AA","#BA68C8","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E","#B2DFDB","#4DB6AC","#009688","#00796B","#004D40","#A5D6A7","#81C784","#66BB6A","#66BB6A","#43A047","#388E3C","#2E7D32","#FFCCBC","#FF8A65","#FF5722","#E64A19","#BF360C","#8D6E63","#6D4C41"],area=["新化區","新營區","鹽水區","白河區","柳營區","後壁區","東山區","麻豆區","下營區","六甲區","官田區","大內區","佳里區","學甲區","西港區","七股區","將軍區","北門區","善化區","新市區","安定區","山上區","玉井區","楠西區","南化區","左鎮區","仁德區","歸仁區","關廟區","龍崎區","永康區","東區","南區","北區","中西區","安南區","安平區"],height=600,data,json_data,padding=6,json_data;d3.json("../../src/faked.json",function(t,e){t&&console.log(t),console.log(e),draw(e)});var bubble=d3.layout.pack().sort(null).size([width,height]).padding(padding),svg=d3.select("#chart").append("svg").attr({width:width,height:height,class:"bubble_chart"});option();var select_date=moment("2016-11-09"),now_date=new moment,now_bar_value=0,duration_day=parseInt((now_date._d-select_date._d)/864e5),dateGOGO=d3.time.format("%Y-%m-%d");d3.select("#scroll_bar").call(d3.slider().min(0).max(duration_day).step(1).on("slide",function(t,e){now_bar_value=e;var n=moment.duration({days:e});select_date=moment("2016-11-09").add(n),d3.select("#show_date").text(dateGOGO(select_date._d)),d3.json("../../src/faked2.json",function(t,e){t&&console.log(t),change(e)})}));var tooltip_div=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);